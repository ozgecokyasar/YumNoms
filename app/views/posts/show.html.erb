


<div class="container" >
  <div class="show">
    <div class="post-details">
      <div>


      <h1><%= @post.title %></h1>
          <% if user_signed_in? && can?(:manage, @post) %>
          <%= link_to 'EDIT', edit_post_path(@post) %>
          <%= link_to 'DELETE', post_path(@post), method: :delete %>
          <% end %>
      <p><%= @post.body %></p>
      <p><strong>Address:</strong><%= @post.address %></p>
      <p><strong>Price:</strong><%= @post.price %></p>
      <p><strong>Availability: </strong> <%= @post.start_time.strftime("%H:%M%P") %> - <%= @post.end_time.strftime("%H:%M%P") %></p>
      <p><strong>Category:</strong> <%= @post.category.name %></p>

      <div class="tags">
        <p><strong>Tags:</strong><% @tags.each do |prod| %>
           <%= link_to prod.name, tag_path(prod) %> |
         <% end %></p>
      </div>



      <div class="faves">
        <% favourite = @post.favourites.find_by(user: current_user) %>
        <% if favourite.present? %>
          <%= link_to fa_icon('heart lg'), post_favourite_path(@post, favourite), method: :delete %>
        <% else %>
          <%= link_to fa_icon('heart-o lg'), post_favourites_path(@post), method: :post %>
        <% end %>
        <%= pluralize @post.favourites.count, 'favourite' %>
      </div>
  </div>

    <div  class="row">
        <%= image_tag @post.image.medium.url if @post.image.present? %>
        <div style='width: 800px;'>
          <div id="map" style='width: 800px; height: 400px;'></div>
        </div>

        <script>
        const handler = Gmaps.build('Google');
        handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
          markers = handler.addMarkers([
            {
              "lat": <%= @post.latitude %>,
              "lng": <%= @post.longitude %>,
              "infowindow": "<%= @post.title%>"
            }
          ]);
          handler.bounds.extendWith(markers);
          handler.fitMapToBounds();
          handler.getMap().setZoom(16);
        });
        </script>
  </div>
</div>

    <hr>
    <div style="margin-top: 50px;">
      <h5>Add Review</h5>
      <%= simple_form_for([@post, Comment.new]) do |f| %>
        <%= f.input :body%>
        <%= f.select :rating, [5, 4 ,3 ,2, 1], class: "browser-default" %>
        <br />
        <br />
        <div>
          <%= f.button :submit,  class: 'btn-primary btn'  %>
        </div>

      <% end %>
    </div>


    <div class="reviews">
      <% @comments.each do |comment| %>

          <div>
            <p><%= comment.body %></p>
            <p><strong>Rating:</strong> <%= comment.rating %>/5</p>
            <p><strong>Review By: </strong> <%= comment.user&.first_name %></p>

            <% if user_signed_in? && can?(:destroy, comment) %>
              <p><%= link_to 'Delete', post_comment_path(@post, comment),
                     method: :delete, data: { confirm: 'Are you sure?' }  %>
              </p>
            <% end %>
            <hr>
          </div>

      <% end %>
    </div>

  </div>
</div>

<h2>Nearby Places:</h2>
  <ul>
    <div>
      <% @post.nearbys(2).each do |nearby_post| %>
      <li>
      <%= link_to nearby_post.title, nearby_post %> (<%= nearby_post.distance.round(5) %> miles)
      </li>
      <% end %>
    </div>

  </ul>
